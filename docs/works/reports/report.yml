---
ReportDefinitions:
- reportName: WorkOrderRegister
  summary: Work Order Register
  version: 1.0.0
  moduleName: works
  viewPath: workOrderRegister
  externalService:
  - entity: $.MdmsRes.Works.TypeOfWork
    apiURL:  http://egov-micro-dev.egovernments.org/egov-mdms-service/v1/_get?moduleName=Works&masterName=TypeOfWork&tenantId=$tenantid&filter=%5B%3F%28%40.parent%3D%3Dnull%20%26%26%20%40.active%3D%3D%27true%27%29%5D
    keyOrder: name,code,description,tenantId
    tableName: tbl_typeofwork
    stateData: true
  - entity: $.MdmsRes.Works.TypeOfWork
    apiURL:  http://egov-micro-dev.egovernments.org/egov-mdms-service/v1/_get?moduleName=Works&masterName=TypeOfWork&tenantId=$tenantid&filter=%5B%3F%28%40.parent%21%3Dnull%20%26%26%20%40.active%3D%3D%27true%27%29%5D
    keyOrder: name, code, description, tenantId
    tableName: tbl_subtypeofwork
    stateData: true
  - entity: $.MdmsRes.egf-master.FinancialYear
    apiURL:  http://egov-micro-dev.egovernments.org/egov-mdms-service/v1/_get?moduleName=egf-master&masterName=FinancialYear&tenantId=$tenantid&filter=%5B%3F%28%40.active%3D%3D%27true%27%29%5D
    keyOrder: finYearRange,startingDate,endingDate,tenantId
    tableName: tbl_financialyear
    stateData: true
  sourceColumns:
  - name: workorderdate
    label: reports.works.workorderdate
    type: epoch
    source: works
  - name: nameofwork
    label: reports.works.nameofwork
    type: string
    source: works
  - name: workordernumber
    label: reports.works.workordernumber
    type: number
    source: works
  - name: filenumber
    label: reports.works.filenumber
    type: string
    source: works
  - name: estimatevalue
    label: reports.works.estimatevalue
    type: number
    source: works
  - name: estimateloaamount
    label: reports.works.estimateloaamount
    type: number
    source: works
  - name: contractorname
    label: reports.works.contractor
    type: string
    source: works
  - name: sanctionedby
    label: reports.works.sanctionedby
    type: string
    source: works
  - name: tenderfinalizedpercentage
    label: reports.works.tenderfinalizedpercentage
    type: number
    source: works
  - name: sanctionedfinyear
    label: reports.works.sanctionedfinyear
    type: string
    source: works
  - name: emdamountdeposited
    label: reports.works.emdamountdeposited
    type: number
    source: works
  - name: securitydeposit
    label: reports.works.securitydeposit
    type: number
    source: works
  searchParams:
  - name: fromDate
    label: reports.works.fromDate
    type: date
    source: works
    searchClause : AND wo.workorderdate>=$fromDate
    isMandatory: false
  - name: toDate
    label: reports.works.toDate
    type: date
    source: works
    searchClause : AND wo.workorderdate<=$toDate
    isMandatory: false
  - name: contractorName
    label: reports.works.contractorname
    type: string
    source: works
    searchClause : AND loa.contractor=$contractorName
    isMandatory: false
  - name: amountFrom
    label: reports.works.amountfrom
    type: number
    source: works
    searchClause : AND loae.estimateloaamount>=$amountFrom
    isMandatory: false
  - name: amountUpto
    label: reports.works.amountupto
    type: number
    source: works
    searchClause : AND loae.estimateloaamount<=$amountUpto
    isMandatory: false

  query: select wo.workorderdate, de.nameofwork, wo.workordernumber, loa.filenumber, de.estimatevalue, loae.estimateloaamount, contractor.name as contractorname, wo.createdby as sanctionedby, loa.tenderfinalizedpercentage, (select finyear.finYearRange from (values tbl_financialyear) as finyear where wo.createdtime between startingDate and endingDate) as sanctionedfinyear, loa.emdamountdeposited, (select sum(amount) from egw_securitydeposit where letterofacceptance=loa.id) as securitydeposit from egw_workorder wo, egw_letterofacceptance loa, egw_letterofacceptanceestimate loae, egw_detailedestimate de, egw_contractor contractor where wo.letterofacceptance=loa.id and wo.letterofacceptance=loae.letterofacceptance and loae.letterofacceptance=loa.id and loae.detailedestimate=de.estimatenumber and contractor.code=loa.contractor




